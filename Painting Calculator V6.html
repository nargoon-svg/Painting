<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Painting Calculator">
    <title>Painting Calculator - Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒÚ¯Ø± Ù†Ù‚Ø§Ø´ÛŒ</title>
    <link rel="manifest" href="manifest.json">
    
    <!-- PDF Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, Tahoma, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            -webkit-user-select: none;
            user-select: none;
        }
        .container { max-width: 1000px; margin: 0 auto; }
        .card { 
            background: white; 
            border-radius: 20px; 
            padding: 20px; 
            margin-bottom: 20px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        h1 { color: #2c5282; font-size: 22px; margin-bottom: 8px; }
        h2 { color: #2d3748; font-size: 18px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 3px solid #4299e1; }
        .btn {
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            width: 100%;
            margin-top: 15px;
            cursor: pointer;
            -webkit-appearance: none;
            touch-action: manipulation;
        }
        .btn-calc { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-download { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; }
        .btn-settings { 
            background: #e2e8f0; 
            padding: 12px 20px; 
            border-radius: 10px;
            font-size: 24px;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #cbd5e0;
            border-radius: 10px;
            font-size: 16px;
            -webkit-appearance: none;
            appearance: none;
        }
        select {
            background: white url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="%23666" d="M5 8l5 5 5-5z"/></svg>') no-repeat left 10px center;
            padding-left: 35px;
        }
        .section-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .section-title {
            font-weight: bold;
            color: #2d3748;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .input-group {
            margin-bottom: 10px;
        }
        .input-label {
            display: block;
            font-size: 13px;
            color: #4a5568;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .result-card {
            background: linear-gradient(135deg, #e0f2fe 0%, #bfdbfe 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
        }
        .result-big {
            font-size: 32px;
            font-weight: bold;
            color: #1e40af;
            text-align: center;
            margin: 20px 0;
        }
        .hidden { display: none !important; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 10px;
            border: 1px solid #e2e8f0;
            text-align: center;
            font-size: 14px;
        }
        th {
            background: #4299e1;
            color: white;
            font-weight: bold;
        }
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .setting-item {
            background: #edf2f7;
            padding: 12px;
            border-radius: 10px;
        }
        .header-flex {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="card">
            <div class="header-flex">
                <div>
                    <h1>ğŸ  Painting Calculator</h1>
                    <p style="color: #718096; font-size: 14px;">Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒÚ¯Ø± Ù†Ù‚Ø§Ø´ÛŒ Ø³Ø§Ø®ØªÙ…Ø§Ù†</p>
                </div>
                <button class="btn-settings" onclick="toggleSettings()">âš™ï¸</button>
            </div>
        </div>

        <!-- Settings Panel -->
        <div id="settings" class="card hidden">
            <h2>âš™ï¸ Settings - ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>
            
            <p style="font-weight: bold; margin: 15px 0; color: #4a5568;">Work Rate (mÂ²/h) - Ù†Ø±Ø® Ú©Ø§Ø±</p>
            <div class="settings-grid">
                <div class="setting-item">
                    <label class="input-label">Simple (Ø³Ø§Ø¯Ù‡)</label>
                    <input type="number" id="rate_simple" value="12" step="0.5">
                </div>
                <div class="setting-item">
                    <label class="input-label">Plastic (Ù¾Ù„Ø§Ø³ØªÛŒÚ©)</label>
                    <input type="number" id="rate_plastic" value="10" step="0.5">
                </div>
                <div class="setting-item">
                    <label class="input-label">Oil (Ø±ÙˆØºÙ†ÛŒ)</label>
                    <input type="number" id="rate_oil" value="8" step="0.5">
                </div>
                <div class="setting-item">
                    <label class="input-label">Acrylic (Ø§Ú©Ø±ÛŒÙ„ÛŒÚ©)</label>
                    <input type="number" id="rate_acrylic" value="9" step="0.5">
                </div>
            </div>

            <p style="font-weight: bold; margin: 15px 0; color: #4a5568;">Condition Multiplier - Ø¶Ø±ÛŒØ¨ ÙˆØ¶Ø¹ÛŒØª</p>
            <div class="settings-grid">
                <div class="setting-item">
                    <label class="input-label">Excellent (Ø¹Ø§Ù„ÛŒ)</label>
                    <input type="number" id="cond_excellent" value="1.0" step="0.1">
                </div>
                <div class="setting-item">
                    <label class="input-label">Good (Ø®ÙˆØ¨)</label>
                    <input type="number" id="cond_good" value="1.3" step="0.1">
                </div>
                <div class="setting-item">
                    <label class="input-label">Fair (Ù…ØªÙˆØ³Ø·)</label>
                    <input type="number" id="cond_fair" value="1.6" step="0.1">
                </div>
                <div class="setting-item">
                    <label class="input-label">Poor (Ø¶Ø¹ÛŒÙ)</label>
                    <input type="number" id="cond_poor" value="2.0" step="0.1">
                </div>
                <div class="setting-item">
                    <label class="input-label">Very Poor (Ø®ÛŒÙ„ÛŒ Ø¶Ø¹ÛŒÙ)</label>
                    <input type="number" id="cond_verypoor" value="2.5" step="0.1">
                </div>
            </div>

            <p style="font-weight: bold; margin: 15px 0; color: #4a5568;">Company Information - Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø±Ú©Øª</p>
            <div class="settings-grid">
                <div class="setting-item" style="grid-column: 1 / -1;">
                    <label class="input-label">Company Name - Ù†Ø§Ù… Ø´Ø±Ú©Øª</label>
                    <input type="text" id="company_name" placeholder="Enter company name - Ù†Ø§Ù… Ø´Ø±Ú©Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                </div>
                <div class="setting-item" style="grid-column: 1 / -1;">
                    <label class="input-label">Company Logo - Ù„ÙˆÚ¯ÙˆÛŒ Ø´Ø±Ú©Øª</label>
                    <input type="file" id="logo_upload" accept="image/*" onchange="handleLogoUpload(event)" style="padding: 8px;">
                    <div id="logo_preview" style="margin-top: 10px; text-align: center;"></div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn" style="background: #48bb78; color: white; flex: 1;" onclick="saveSettings()">ğŸ’¾ Save Settings - Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
                <button class="btn" style="background: #f56565; color: white; flex: 1;" onclick="resetSettings()">ğŸ”„ Reset to Default - Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶</button>
            </div>
        </div>

        <!-- Wall Section -->
        <div class="card">
            <div class="section-row">
                <div class="section-title">ğŸ§± Wall - Ø¯ÛŒÙˆØ§Ø±</div>
                <div class="input-group">
                    <label class="input-label">Area (Ù…ØªØ±Ø§Ú˜ mÂ²)</label>
                    <input type="number" id="wall_area" placeholder="0">
                </div>
                <div class="input-group">
                    <label class="input-label">Condition - ÙˆØ¶Ø¹ÛŒØª</label>
                    <select id="wall_condition">
                        <option value="excellent">Excellent (Ø¹Ø§Ù„ÛŒ)</option>
                        <option value="good" selected>Good (Ø®ÙˆØ¨)</option>
                        <option value="fair">Fair (Ù…ØªÙˆØ³Ø·)</option>
                        <option value="poor">Poor (Ø¶Ø¹ÛŒÙ)</option>
                        <option value="verypoor">Very Poor (Ø®ÛŒÙ„ÛŒ Ø¶Ø¹ÛŒÙ)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Paint Type - Ù†ÙˆØ¹ Ø±Ù†Ú¯</label>
                    <select id="wall_paint">
                        <option value="simple">Simple (Ø³Ø§Ø¯Ù‡)</option>
                        <option value="plastic" selected>Plastic (Ù¾Ù„Ø§Ø³ØªÛŒÚ©)</option>
                        <option value="oil">Oil (Ø±ÙˆØºÙ†ÛŒ)</option>
                        <option value="acrylic">Acrylic (Ø§Ú©Ø±ÛŒÙ„ÛŒÚ©)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Ceiling Section -->
        <div class="card">
            <div class="section-row">
                <div class="section-title">ğŸ  Ceiling - Ø³Ù‚Ù</div>
                <div class="input-group">
                    <label class="input-label">Area (Ù…ØªØ±Ø§Ú˜ mÂ²)</label>
                    <input type="number" id="ceiling_area" placeholder="0">
                </div>
                <div class="input-group">
                    <label class="input-label">Condition - ÙˆØ¶Ø¹ÛŒØª</label>
                    <select id="ceiling_condition">
                        <option value="excellent">Excellent (Ø¹Ø§Ù„ÛŒ)</option>
                        <option value="good" selected>Good (Ø®ÙˆØ¨)</option>
                        <option value="fair">Fair (Ù…ØªÙˆØ³Ø·)</option>
                        <option value="poor">Poor (Ø¶Ø¹ÛŒÙ)</option>
                        <option value="verypoor">Very Poor (Ø®ÛŒÙ„ÛŒ Ø¶Ø¹ÛŒÙ)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Paint Type - Ù†ÙˆØ¹ Ø±Ù†Ú¯</label>
                    <select id="ceiling_paint">
                        <option value="simple">Simple (Ø³Ø§Ø¯Ù‡)</option>
                        <option value="plastic" selected>Plastic (Ù¾Ù„Ø§Ø³ØªÛŒÚ©)</option>
                        <option value="oil">Oil (Ø±ÙˆØºÙ†ÛŒ)</option>
                        <option value="acrylic">Acrylic (Ø§Ú©Ø±ÛŒÙ„ÛŒÚ©)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Door Section -->
        <div class="card">
            <div class="section-row">
                <div class="section-title">ğŸšª Door - Ø¯Ø±</div>
                <div class="input-group">
                    <label class="input-label">Count (ØªØ¹Ø¯Ø§Ø¯)</label>
                    <input type="number" id="door_count" placeholder="0">
                </div>
                <div class="input-group">
                    <label class="input-label">Condition - ÙˆØ¶Ø¹ÛŒØª</label>
                    <select id="door_condition">
                        <option value="excellent">Excellent (Ø¹Ø§Ù„ÛŒ)</option>
                        <option value="good" selected>Good (Ø®ÙˆØ¨)</option>
                        <option value="fair">Fair (Ù…ØªÙˆØ³Ø·)</option>
                        <option value="poor">Poor (Ø¶Ø¹ÛŒÙ)</option>
                        <option value="verypoor">Very Poor (Ø®ÛŒÙ„ÛŒ Ø¶Ø¹ÛŒÙ)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Paint Type - Ù†ÙˆØ¹ Ø±Ù†Ú¯</label>
                    <select id="door_paint">
                        <option value="simple">Simple (Ø³Ø§Ø¯Ù‡)</option>
                        <option value="plastic">Plastic (Ù¾Ù„Ø§Ø³ØªÛŒÚ©)</option>
                        <option value="oil" selected>Oil (Ø±ÙˆØºÙ†ÛŒ)</option>
                        <option value="acrylic">Acrylic (Ø§Ú©Ø±ÛŒÙ„ÛŒÚ©)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Window Section -->
        <div class="card">
            <div class="section-row">
                <div class="section-title">ğŸªŸ Window - Ù¾Ù†Ø¬Ø±Ù‡</div>
                <div class="input-group">
                    <label class="input-label">Count (ØªØ¹Ø¯Ø§Ø¯)</label>
                    <input type="number" id="window_count" placeholder="0">
                </div>
                <div class="input-group">
                    <label class="input-label">Condition - ÙˆØ¶Ø¹ÛŒØª</label>
                    <select id="window_condition">
                        <option value="excellent">Excellent (Ø¹Ø§Ù„ÛŒ)</option>
                        <option value="good" selected>Good (Ø®ÙˆØ¨)</option>
                        <option value="fair">Fair (Ù…ØªÙˆØ³Ø·)</option>
                        <option value="poor">Poor (Ø¶Ø¹ÛŒÙ)</option>
                        <option value="verypoor">Very Poor (Ø®ÛŒÙ„ÛŒ Ø¶Ø¹ÛŒÙ)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Paint Type - Ù†ÙˆØ¹ Ø±Ù†Ú¯</label>
                    <select id="window_paint">
                        <option value="simple">Simple (Ø³Ø§Ø¯Ù‡)</option>
                        <option value="plastic">Plastic (Ù¾Ù„Ø§Ø³ØªÛŒÚ©)</option>
                        <option value="oil" selected>Oil (Ø±ÙˆØºÙ†ÛŒ)</option>
                        <option value="acrylic">Acrylic (Ø§Ú©Ø±ÛŒÙ„ÛŒÚ©)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Railing Section -->
        <div class="card">
            <div class="section-row">
                <div class="section-title">ğŸ›¡ï¸ Railing - Ù†Ø±Ø¯Ù‡</div>
                <div class="input-group">
                    <label class="input-label">Length (Ø·ÙˆÙ„ meters)</label>
                    <input type="number" id="railing_length" placeholder="0">
                </div>
                <div class="input-group">
                    <label class="input-label">Condition - ÙˆØ¶Ø¹ÛŒØª</label>
                    <select id="railing_condition">
                        <option value="excellent">Excellent (Ø¹Ø§Ù„ÛŒ)</option>
                        <option value="good" selected>Good (Ø®ÙˆØ¨)</option>
                        <option value="fair">Fair (Ù…ØªÙˆØ³Ø·)</option>
                        <option value="poor">Poor (Ø¶Ø¹ÛŒÙ)</option>
                        <option value="verypoor">Very Poor (Ø®ÛŒÙ„ÛŒ Ø¶Ø¹ÛŒÙ)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Paint Type - Ù†ÙˆØ¹ Ø±Ù†Ú¯</label>
                    <select id="railing_paint">
                        <option value="simple">Simple (Ø³Ø§Ø¯Ù‡)</option>
                        <option value="plastic">Plastic (Ù¾Ù„Ø§Ø³ØªÛŒÚ©)</option>
                        <option value="oil">Oil (Ø±ÙˆØºÙ†ÛŒ)</option>
                        <option value="acrylic" selected>Acrylic (Ø§Ú©Ø±ÛŒÙ„ÛŒÚ©)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Cornice Section -->
        <div class="card">
            <div class="section-row">
                <div class="section-title">ğŸ“ Cornice - Ù‚Ø±Ù†ÛŒØ²</div>
                <div class="input-group">
                    <label class="input-label">Length (Ø·ÙˆÙ„ meters)</label>
                    <input type="number" id="cornice_length" placeholder="0">
                </div>
                <div class="input-group">
                    <label class="input-label">Condition - ÙˆØ¶Ø¹ÛŒØª</label>
                    <select id="cornice_condition">
                        <option value="excellent">Excellent (Ø¹Ø§Ù„ÛŒ)</option>
                        <option value="good" selected>Good (Ø®ÙˆØ¨)</option>
                        <option value="fair">Fair (Ù…ØªÙˆØ³Ø·)</option>
                        <option value="poor">Poor (Ø¶Ø¹ÛŒÙ)</option>
                        <option value="verypoor">Very Poor (Ø®ÛŒÙ„ÛŒ Ø¶Ø¹ÛŒÙ)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Paint Type - Ù†ÙˆØ¹ Ø±Ù†Ú¯</label>
                    <select id="cornice_paint">
                        <option value="simple">Simple (Ø³Ø§Ø¯Ù‡)</option>
                        <option value="plastic" selected>Plastic (Ù¾Ù„Ø§Ø³ØªÛŒÚ©)</option>
                        <option value="oil">Oil (Ø±ÙˆØºÙ†ÛŒ)</option>
                        <option value="acrylic">Acrylic (Ø§Ú©Ø±ÛŒÙ„ÛŒÚ©)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Workers & Cleaning -->
        <div class="card">
            <div class="settings-grid">
                <div class="input-group">
                    <label class="input-label">ğŸ‘· Workers - Ù†Ù‚Ø§Ø´</label>
                    <input type="number" id="workers" value="1" min="1">
                </div>
                <div class="input-group">
                    <label class="input-label">ğŸ§¹ Cleaning (h) - Ù†Ø¸Ø§ÙØª</label>
                    <input type="number" id="cleaning" value="4" min="0" step="0.5">
                </div>
            </div>
            <button class="btn btn-calc" onclick="calculate()">ğŸ§® Calculate - Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
        </div>

        <!-- Results -->
        <div id="results" class="card hidden">
            <h2>ğŸ“Š Results - Ù†ØªØ§ÛŒØ¬</h2>
            <div id="resultsContent"></div>
            <button class="btn btn-download" onclick="downloadReport()">ğŸ“¥ Download Report - Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú¯Ø²Ø§Ø±Ø´</button>
        </div>
    </div>

    <script>
        var appData = { results: null };

        // Default settings
        var defaultSettings = {
            rates: { simple: 12, plastic: 10, oil: 8, acrylic: 9 },
            conditions: { excellent: 1.0, good: 1.3, fair: 1.6, poor: 2.0, verypoor: 2.5 }
        };

        // Load settings on page load
        window.onload = function() {
            loadSettings();
        };

        function handleLogoUpload(event) {
            var file = event.target.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    var logoData = e.target.result;
                    localStorage.setItem('companyLogo', logoData);
                    showLogoPreview(logoData);
                };
                reader.readAsDataURL(file);
            }
        }

        function showLogoPreview(logoData) {
            var preview = document.getElementById('logo_preview');
            if (logoData) {
                preview.innerHTML = '<img src="' + logoData + '" style="max-width: 150px; max-height: 150px; border: 2px solid #cbd5e0; border-radius: 8px;">';
            } else {
                preview.innerHTML = '';
            }
        }

        function loadSettings() {
            var saved = localStorage.getItem('paintingSettings');
            if (saved) {
                try {
                    var settings = JSON.parse(saved);
                    // Load rates
                    for (var key in settings.rates) {
                        var el = document.getElementById('rate_' + key);
                        if (el) el.value = settings.rates[key];
                    }
                    // Load conditions
                    for (var key in settings.conditions) {
                        var el = document.getElementById('cond_' + key);
                        if (el) el.value = settings.conditions[key];
                    }
                    // Load company name
                    if (settings.companyName) {
                        var nameEl = document.getElementById('company_name');
                        if (nameEl) nameEl.value = settings.companyName;
                    }
                } catch(e) {
                    console.error('Error loading settings:', e);
                }
            }
            
            // Load logo
            var logo = localStorage.getItem('companyLogo');
            if (logo) {
                showLogoPreview(logo);
            }
        }

        function saveSettings() {
            var settings = {
                rates: {
                    simple: getVal('rate_simple'),
                    plastic: getVal('rate_plastic'),
                    oil: getVal('rate_oil'),
                    acrylic: getVal('rate_acrylic')
                },
                conditions: {
                    excellent: getVal('cond_excellent'),
                    good: getVal('cond_good'),
                    fair: getVal('cond_fair'),
                    poor: getVal('cond_poor'),
                    verypoor: getVal('cond_verypoor')
                },
                companyName: document.getElementById('company_name').value || ''
            };
            localStorage.setItem('paintingSettings', JSON.stringify(settings));
            alert('âœ… Settings saved successfully!\nØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!');
        }

        function resetSettings() {
            if (confirm('Are you sure you want to reset to default settings?\nØ¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø§Ø²Ú¯Ø±Ø¯ÛŒØ¯ØŸ')) {
                // Reset rates
                for (var key in defaultSettings.rates) {
                    var el = document.getElementById('rate_' + key);
                    if (el) el.value = defaultSettings.rates[key];
                }
                // Reset conditions
                for (var key in defaultSettings.conditions) {
                    var el = document.getElementById('cond_' + key);
                    if (el) el.value = defaultSettings.conditions[key];
                }
                // Reset company info
                document.getElementById('company_name').value = '';
                document.getElementById('logo_preview').innerHTML = '';
                
                localStorage.removeItem('paintingSettings');
                localStorage.removeItem('companyLogo');
                alert('âœ… Settings reset to default!\nØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø§Ø²Ú¯Ø´Øª!');
            }
        }

        function toggleSettings() {
            var el = document.getElementById('settings');
            if (el.classList.contains('hidden')) {
                el.classList.remove('hidden');
            } else {
                el.classList.add('hidden');
            }
        }

        function getVal(id) {
            return parseFloat(document.getElementById(id).value) || 0;
        }

        function calculate() {
            var sections = [
                { name: 'Wall (Ø¯ÛŒÙˆØ§Ø±)', id: 'wall', type: 'area', unit: 1 },
                { name: 'Ceiling (Ø³Ù‚Ù)', id: 'ceiling', type: 'area', unit: 1 },
                { name: 'Door (Ø¯Ø±)', id: 'door', type: 'count', unit: 2 },
                { name: 'Window (Ù¾Ù†Ø¬Ø±Ù‡)', id: 'window', type: 'count', unit: 1.5 },
                { name: 'Railing (Ù†Ø±Ø¯Ù‡)', id: 'railing', type: 'length', unit: 0.5 },
                { name: 'Cornice (Ù‚Ø±Ù†ÛŒØ²)', id: 'cornice', type: 'length', unit: 0.3 }
            ];

            var total = 0;
            var results = [];

            for (var i = 0; i < sections.length; i++) {
                var s = sections[i];
                var val = getVal(s.id + '_' + s.type);
                
                if (val > 0) {
                    var area = val * s.unit;
                    var paint = document.getElementById(s.id + '_paint').value;
                    var cond = document.getElementById(s.id + '_condition').value;
                    var rate = getVal('rate_' + paint);
                    var mult = getVal('cond_' + cond);
                    var time = (area / rate) * mult;
                    
                    total += time;
                    results.push({
                        name: s.name,
                        area: area.toFixed(2),
                        paint: paint,
                        cond: cond,
                        time: time.toFixed(1)
                    });
                }
            }

            var workers = getVal('workers') || 1;
            var cleaning = getVal('cleaning');
            var perWorker = total / workers;
            var final = perWorker + cleaning;

            appData.results = {
                sections: results,
                total: total.toFixed(1),
                perWorker: perWorker.toFixed(1),
                cleaning: cleaning,
                final: final.toFixed(1),
                days: (final / 8).toFixed(1),
                workers: workers
            };

            showResults();
        }

        function showResults() {
            var r = appData.results;
            var html = '<table><tr><th>Section</th><th>Area</th><th>Paint</th><th>Condition</th><th>Time</th></tr>';
            
            for (var i = 0; i < r.sections.length; i++) {
                var s = r.sections[i];
                html += '<tr><td>' + s.name + '</td><td>' + s.area + '</td><td>' + s.paint + '</td><td>' + s.cond + '</td><td><b>' + s.time + '</b></td></tr>';
            }
            html += '</table>';

            html += '<div class="result-card">';
            html += '<p><b>Total Work:</b> ' + r.total + ' h</p>';
            html += '<p><b>Workers:</b> ' + r.workers + '</p>';
            html += '<p><b>Per Worker:</b> ' + r.perWorker + ' h</p>';
            html += '<p><b>Cleaning:</b> ' + r.cleaning + ' h</p>';
            html += '<div class="result-big">âœ… ' + r.final + ' h<br>(' + r.days + ' days)</div>';
            html += '</div>';

            document.getElementById('resultsContent').innerHTML = html;
            document.getElementById('results').classList.remove('hidden');
        }

        function downloadReport() {
            var r = appData.results;
            if (!r) return;

            // Get saved company info
            var companyName = document.getElementById('company_name').value || 'Company Name - Ù†Ø§Ù… Ø´Ø±Ú©Øª';
            var logoData = localStorage.getItem('companyLogo') || '';

            var html = '<!DOCTYPE html><html dir="rtl"><head><meta charset="UTF-8"><title>Painting Report</title>';
            html += '<style>body{font-family:Tahoma,Arial;padding:30px;line-height:1.6;}';
            html += '.logo-container{text-align:center;margin-bottom:30px;padding:20px;border-bottom:2px solid #e2e8f0;}';
            html += '.logo-img{max-width:150px;max-height:150px;margin:0 auto 15px;display:block;}';
            html += '.logo-placeholder{width:150px;height:150px;margin:0 auto 15px;border:3px dashed #cbd5e0;border-radius:10px;display:flex;align-items:center;justify-content:center;color:#a0aec0;font-size:14px;background:#f7fafc;}';
            html += 'h1{text-align:center;color:#2c5282;border-bottom:3px solid #333;padding-bottom:15px;margin-top:0;}';
            html += 'table{width:100%;border-collapse:collapse;margin:20px 0;}th,td{padding:10px;border:1px solid #ddd;text-align:center;}';
            html += 'th{background:#4299e1;color:white;}.summary{background:#edf2f7;padding:20px;border-radius:10px;margin:20px 0;}';
            html += '.final{background:#d4edda;padding:20px;border-radius:10px;font-size:1.3em;text-align:center;}</style></head><body>';
            
            // Logo Section
            html += '<div class="logo-container">';
            if (logoData) {
                html += '<img src="' + logoData + '" class="logo-img" alt="Company Logo">';
            } else {
                html += '<div class="logo-placeholder">Your Logo Here<br>Ù„ÙˆÚ¯ÙˆÛŒ Ø´Ù…Ø§</div>';
            }
            html += '<p style="color:#718096;font-size:16px;font-weight:bold;">' + companyName + '</p>';
            html += '</div>';
            
            html += '<h1>Painting Project Report<br>Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø±ÙˆÚ˜Ù‡ Ù†Ù‚Ø§Ø´ÛŒ</h1>';
            html += '<p style="text-align:center;color:#666;">Date: ' + new Date().toLocaleDateString() + '</p>';
            
            html += '<h2>Work Sections - Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±ÛŒ</h2><table><tr><th>Section</th><th>Area (mÂ²)</th><th>Paint</th><th>Condition</th><th>Time (h)</th></tr>';
            for (var i = 0; i < r.sections.length; i++) {
                var s = r.sections[i];
                html += '<tr><td>' + s.name + '</td><td>' + s.area + '</td><td>' + s.paint + '</td><td>' + s.cond + '</td><td><b>' + s.time + '</b></td></tr>';
            }
            html += '</table>';
            
            html += '<div class="summary"><h3>Time Summary - Ø®Ù„Ø§ØµÙ‡ Ø²Ù…Ø§Ù†</h3>';
            html += '<p><b>Total Work Hours:</b> ' + r.total + ' hours</p>';
            html += '<p><b>Workers:</b> ' + r.workers + ' person(s)</p>';
            html += '<p><b>Per Worker:</b> ' + r.perWorker + ' hours</p>';
            html += '<p><b>Cleaning:</b> ' + r.cleaning + ' hours</p></div>';
            
            html += '<div class="final"><b>Final Total:</b> ' + r.final + ' hours (' + r.days + ' days)<br>';
            html += '<b>Ø¬Ù…Ø¹ Ú©Ù„:</b> ' + r.final + ' Ø³Ø§Ø¹Øª (' + r.days + ' Ø±ÙˆØ²)</div>';
            
            html += '</body></html>';

            // Create temporary element for PDF generation
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;
            tempDiv.style.position = 'absolute';
            tempDiv.style.left = '-9999px';
            tempDiv.style.width = '800px';
            tempDiv.style.background = 'white';
            tempDiv.style.padding = '40px';
            document.body.appendChild(tempDiv);

            // Generate PDF using html2canvas and jsPDF
            html2canvas(tempDiv, { 
                scale: 2,
                logging: false,
                useCORS: true
            }).then(function(canvas) {
                document.body.removeChild(tempDiv);
                
                var imgData = canvas.toDataURL('image/png');
                var pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                
                var pdfWidth = pdf.internal.pageSize.getWidth();
                var pdfHeight = pdf.internal.pageSize.getHeight();
                var imgWidth = pdfWidth;
                var imgHeight = (canvas.height * pdfWidth) / canvas.width;
                
                var heightLeft = imgHeight;
                var position = 0;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pdfHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pdfHeight;
                }

                pdf.save('Painting-Report-' + Date.now() + '.pdf');
            }).catch(function(error) {
                console.error('PDF generation error:', error);
                alert('Error generating PDF. Downloading HTML instead.');
                // Fallback to HTML download
                var blob = new Blob([html], { type: 'text/html;charset=utf-8' });
                var url = URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = 'Painting-Report-' + Date.now() + '.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }
    </script>
</body>
</html>