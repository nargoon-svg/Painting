<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Painting Calculator - محاسبه‌گر نقاشی ساختمان</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * { 
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body { 
            font-family: Tahoma, Arial, sans-serif;
            -webkit-text-size-adjust: 100%;
            margin: 0;
            padding: 0;
        }
        input, select, button { 
            font-size: 16px !important;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: left 0.5rem center;
            background-size: 1.5em 1.5em;
            padding-left: 2.5rem;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-2 md:p-4">
    <div id="app" class="max-w-6xl mx-auto"></div>
    
    <!-- PDF Template -->
    <div id="pdfContent" style="display:none; padding:40px; background:white; width:800px; font-family:Tahoma,Arial;">
        <div style="text-align:center; border-bottom:3px solid #333; padding-bottom:20px; margin-bottom:30px;">
            <h1 style="color:#2c5282; margin:0; font-size:28px;">Painting Project Report</h1>
            <h2 style="color:#2c5282; margin:5px 0; font-size:24px;">گزارش پروژه نقاشی ساختمان</h2>
            <p id="pdfDate" style="margin:10px 0; font-size:14px;"></p>
        </div>
        <div id="pdfSections"></div>
        <div id="pdfSummary"></div>
        <div style="text-align:center; margin-top:40px; padding-top:20px; border-top:2px solid #e2e8f0; color:#718096; font-size:12px;">
            <p>Generated by Painting Calculator System</p>
            <p>تولید شده توسط سیستم محاسبه نقاشی ساختمان</p>
        </div>
    </div>

    <script>
        var app = {
            showSettings: false,
            paintTypes: {
                simple: { name: 'Simple Paint (رنگ ساده)', rate: 12 },
                plastic: { name: 'Plastic Paint (پلاستیک)', rate: 10 },
                oil: { name: 'Oil Paint (روغنی)', rate: 8 },
                acrylic: { name: 'Acrylic Paint (اکریلیک)', rate: 9 }
            },
            wallConditions: {
                excellent: { name: 'Excellent (عالی)', multiplier: 1.0 },
                good: { name: 'Good (خوب)', multiplier: 1.3 },
                fair: { name: 'Fair (متوسط)', multiplier: 1.6 },
                poor: { name: 'Poor (ضعیف)', multiplier: 2.0 },
                verypoor: { name: 'Very Poor (خیلی ضعیف)', multiplier: 2.5 }
            },
            sections: [
                { id: 1, name: 'Wall (دیوار)', area: '', paintType: 'plastic', condition: 'good' },
                { id: 2, name: 'Ceiling (سقف)', area: '', paintType: 'plastic', condition: 'good' },
                { id: 3, name: 'Door (در)', count: '', areaPerUnit: 2, paintType: 'oil', condition: 'good' },
                { id: 4, name: 'Window (پنجره)', count: '', areaPerUnit: 1.5, paintType: 'oil', condition: 'good' },
                { id: 5, name: 'Railing (نرده)', length: '', areaPerMeter: 0.5, paintType: 'acrylic', condition: 'good' },
                { id: 6, name: 'Cornice (قرنیز)', length: '', areaPerMeter: 0.3, paintType: 'plastic', condition: 'good' }
            ],
            workers: 1,
            finalCleaningHours: 4,
            result: null
        };

        function updateSection(id, field, value) {
            for (var i = 0; i < app.sections.length; i++) {
                if (app.sections[i].id === id) {
                    app.sections[i][field] = value;
                    break;
                }
            }
        }

        function toggleSettings() {
            app.showSettings = !app.showSettings;
            render();
        }

        function updatePaintRate(key, value) {
            app.paintTypes[key].rate = parseFloat(value) || 0;
        }

        function updateConditionMultiplier(key, value) {
            app.wallConditions[key].multiplier = parseFloat(value) || 0;
        }

        function calculateTime() {
            var totalTime = 0;
            var sectionResults = [];

            for (var i = 0; i < app.sections.length; i++) {
                var section = app.sections[i];
                var area = 0;
                
                if (section.area !== undefined && section.area !== '') {
                    area = parseFloat(section.area) || 0;
                } else if (section.count !== undefined && section.count !== '') {
                    var count = parseFloat(section.count) || 0;
                    area = count * section.areaPerUnit;
                } else if (section.length !== undefined && section.length !== '') {
                    var length = parseFloat(section.length) || 0;
                    area = length * section.areaPerMeter;
                }

                if (area > 0) {
                    var paintRate = app.paintTypes[section.paintType].rate;
                    var conditionMultiplier = app.wallConditions[section.condition].multiplier;
                    var sectionTime = (area / paintRate) * conditionMultiplier;
                    
                    totalTime += sectionTime;
                    
                    sectionResults.push({
                        name: section.name,
                        area: area.toFixed(2),
                        paintType: app.paintTypes[section.paintType].name,
                        condition: app.wallConditions[section.condition].name,
                        time: sectionTime.toFixed(1)
                    });
                }
            }

            var workTime = totalTime / app.workers;
            var finalTime = workTime + app.finalCleaningHours;

            app.result = {
                sections: sectionResults,
                totalWorkTime: totalTime.toFixed(1),
                timePerWorker: workTime.toFixed(1),
                cleaningTime: app.finalCleaningHours,
                finalTotalTime: finalTime.toFixed(1),
                days: (finalTime / 8).toFixed(1),
                workers: app.workers
            };

            render();
        }

        function generatePDF() {
            if (!app.result) {
                alert('Please calculate first - لطفا ابتدا محاسبات را انجام دهید');
                return;
            }

            // Fill PDF content
            var today = new Date();
            document.getElementById('pdfDate').innerText = today.toLocaleDateString('en-US') + ' / ' + today.toLocaleDateString('fa-IR');
            
            // Sections table
            var sectionsHTML = '<h2 style="color:#2d3748; border-bottom:2px solid #4299e1; padding-bottom:8px; margin-bottom:15px;">Work Sections - بخش‌های کاری</h2>';
            sectionsHTML += '<table style="width:100%; border-collapse:collapse; margin:15px 0;">';
            sectionsHTML += '<tr style="background:#4299e1; color:white;">';
            sectionsHTML += '<th style="padding:10px; text-align:right; border:1px solid #e2e8f0;">Section - بخش</th>';
            sectionsHTML += '<th style="padding:10px; text-align:center; border:1px solid #e2e8f0;">Area - مساحت (m²)</th>';
            sectionsHTML += '<th style="padding:10px; text-align:center; border:1px solid #e2e8f0;">Paint Type - نوع رنگ</th>';
            sectionsHTML += '<th style="padding:10px; text-align:center; border:1px solid #e2e8f0;">Condition - وضعیت</th>';
            sectionsHTML += '<th style="padding:10px; text-align:center; border:1px solid #e2e8f0;">Time - زمان (h)</th>';
            sectionsHTML += '</tr>';
            
            for (var i = 0; i < app.result.sections.length; i++) {
                var s = app.result.sections[i];
                var bgColor = i % 2 === 0 ? '#f7fafc' : 'white';
                sectionsHTML += '<tr style="background:' + bgColor + ';">';
                sectionsHTML += '<td style="padding:10px; border:1px solid #e2e8f0; text-align:right;">' + s.name + '</td>';
                sectionsHTML += '<td style="padding:10px; border:1px solid #e2e8f0; text-align:center;">' + s.area + '</td>';
                sectionsHTML += '<td style="padding:10px; border:1px solid #e2e8f0; text-align:center; font-size:11px;">' + s.paintType + '</td>';
                sectionsHTML += '<td style="padding:10px; border:1px solid #e2e8f0; text-align:center; font-size:11px;">' + s.condition + '</td>';
                sectionsHTML += '<td style="padding:10px; border:1px solid #e2e8f0; text-align:center; font-weight:bold;">' + s.time + '</td>';
                sectionsHTML += '</tr>';
            }
            sectionsHTML += '</table>';
            
            document.getElementById('pdfSections').innerHTML = sectionsHTML;
            
            // Summary
            var summaryHTML = '<div style="background:#edf2f7; padding:20px; border-right:4px solid #4299e1; margin:20px 0; border-radius:8px;">';
            summaryHTML += '<h3 style="color:#2c5282; margin-top:0;">⏱️ Time Summary - خلاصه زمان</h3>';
            summaryHTML += '<p style="margin:8px 0;"><strong>Total Work Hours - مجموع ساعت کار:</strong> ' + app.result.totalWorkTime + ' hours - ساعت</p>';
            summaryHTML += '<p style="margin:8px 0;"><strong>Number of Workers - تعداد نقاش:</strong> ' + app.result.workers + ' person(s) - نفر</p>';
            summaryHTML += '<p style="margin:8px 0;"><strong>Work Time Per Worker - ساعت کار هر نقاش:</strong> ' + app.result.timePerWorker + ' hours - ساعت</p>';
            summaryHTML += '<p style="margin:8px 0;"><strong>Cleaning & Final Control - نظافت و کنترل نهایی:</strong> ' + app.result.cleaningTime + ' hours - ساعت</p>';
            summaryHTML += '</div>';
            
            summaryHTML += '<div style="background:#d4edda; padding:20px; border-radius:8px; margin:20px 0; border:2px solid #28a745;">';
            summaryHTML += '<h3 style="margin-top:0; color:#155724;">✅ Final Total - جمع کل نهایی</h3>';
            summaryHTML += '<p style="font-size:1.4em; margin:10px 0;"><strong>Total Hours - مجموع ساعات:</strong> ' + app.result.finalTotalTime + ' hours - ساعت</p>';
            summaryHTML += '<p style="font-size:1.4em; margin:10px 0;"><strong>Working Days (8h) - روز کاری:</strong> ' + app.result.days + ' days - روز</p>';
            summaryHTML += '</div>';
            
            document.getElementById('pdfSummary').innerHTML = summaryHTML;
            
            // Generate PDF
            var element = document.getElementById('pdfContent');
            element.style.display = 'block';
            
            html2canvas(element, { scale: 2 }).then(function(canvas) {
                element.style.display = 'none';
                
                var imgData = canvas.toDataURL('image/png');
                var pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                var imgWidth = 210;
                var pageHeight = 297;
                var imgHeight = canvas.height * imgWidth / canvas.width;
                var heightLeft = imgHeight;
                var position = 0;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                pdf.save('Painting-Report-' + new Date().getTime() + '.pdf');
            });
        }

        function render() {
            var html = '';
            
            // Header
            html += '<div class="bg-white rounded-2xl shadow-xl p-4 md:p-6 mb-4 md:mb-6">';
            html += '<div class="flex items-center justify-between">';
            html += '<div class="flex items-center gap-2 md:gap-3">';
            html += '<svg class="w-6 h-6 md:w-8 md:h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>';
            html += '<div>';
            html += '<h1 class="text-lg md:text-3xl font-bold text-gray-800">Painting Calculator</h1>';
            html += '<p class="text-xs md:text-base text-gray-600">محاسبه‌گر نقاشی</p>';
            html += '</div></div>';
            html += '<button onclick="toggleSettings()" class="bg-gray-100 hover:bg-gray-200 p-2 md:p-3 rounded-lg transition-all">';
            html += '<svg class="w-5 h-5 md:w-6 md:h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>';
            html += '</button></div></div>';

            // Settings Panel
            if (app.showSettings) {
                html += '<div class="bg-white rounded-2xl shadow-xl p-4 md:p-6 mb-4 md:mb-6">';
                html += '<h2 class="text-lg md:text-xl font-bold text-gray-800 mb-4">Settings - تنظیمات</h2>';
                
                html += '<div class="mb-6"><h3 class="font-bold text-gray-700 mb-3 pb-2 border-b">Work Rate - نرخ کار (m²/h)</h3>';
                html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">';
                for (var key in app.paintTypes) {
                    var pt = app.paintTypes[key];
                    html += '<div class="bg-blue-50 p-3 rounded-lg">';
                    html += '<label class="block text-xs md:text-sm font-medium text-gray-700 mb-2">' + pt.name + '</label>';
                    html += '<input type="number" step="0.5" value="' + pt.rate + '" onchange="updatePaintRate(\'' + key + '\', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-lg">';
                    html += '</div>';
                }
                html += '</div></div>';

                html += '<div><h3 class="font-bold text-gray-700 mb-3 pb-2 border-b">Condition Multiplier - ضریب وضعیت</h3>';
                html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">';
                for (var key in app.wallConditions) {
                    var wc = app.wallConditions[key];
                    html += '<div class="bg-purple-50 p-3 rounded-lg">';
                    html += '<label class="block text-xs md:text-sm font-medium text-gray-700 mb-2">' + wc.name + '</label>';
                    html += '<input type="number" step="0.1" value="' + wc.multiplier + '" onchange="updateConditionMultiplier(\'' + key + '\', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-lg">';
                    html += '</div>';
                }
                html += '</div></div>';
                
                html += '</div>';
            }

            // Main Form
            html += '<div class="bg-white rounded-2xl shadow-xl p-4 md:p-6 mb-4 md:mb-6">';
            html += '<h2 class="text-lg md:text-xl font-bold text-gray-800 mb-4">Project Info - اطلاعات پروژه</h2>';
            
            html += '<div class="overflow-x-auto"><table class="w-full min-w-full">';
            html += '<thead><tr class="bg-blue-600 text-white">';
            html += '<th class="p-2 md:p-3 text-right text-xs md:text-sm">Section - بخش</th>';
            html += '<th class="p-2 md:p-3 text-center text-xs md:text-sm">متراژ/تعداد</th>';
            html += '<th class="p-2 md:p-3 text-center text-xs md:text-sm">وضعیت</th>';
            html += '<th class="p-2 md:p-3 text-center text-xs md:text-sm">نوع رنگ</th>';
            html += '</tr></thead><tbody>';

            for (var i = 0; i < app.sections.length; i++) {
                var section = app.sections[i];
                var bgClass = i % 2 === 0 ? 'bg-gray-50' : 'bg-white';
                html += '<tr class="' + bgClass + '">';
                html += '<td class="p-2 md:p-3 text-xs md:text-sm font-medium">' + section.name + '</td>';
                html += '<td class="p-2 md:p-3">';
                
                if (section.area !== undefined) {
                    html += '<input type="number" placeholder="m²" value="' + section.area + '" oninput="updateSection(' + section.id + ', \'area\', this.value)" class="w-full px-2 py-1 md:px-3 md:py-2 border rounded-lg text-center text-sm">';
                } else if (section.count !== undefined) {
                    html += '<input type="number" placeholder="count" value="' + section.count + '" oninput="updateSection(' + section.id + ', \'count\', this.value)" class="w-full px-2 py-1 md:px-3 md:py-2 border rounded-lg text-center text-sm">';
                } else if (section.length !== undefined) {
                    html += '<input type="number" placeholder="meters" value="' + section.length + '" oninput="updateSection(' + section.id + ', \'length\', this.value)" class="w-full px-2 py-1 md:px-3 md:py-2 border rounded-lg text-center text-sm">';
                }
                
                html += '</td><td class="p-2 md:p-3">';
                html += '<select onchange="updateSection(' + section.id + ', \'condition\', this.value); render();" class="w-full px-2 py-1 md:px-3 md:py-2 border rounded-lg text-xs md:text-sm">';
                for (var key in app.wallConditions) {
                    var selected = section.condition === key ? 'selected' : '';
                    html += '<option value="' + key + '" ' + selected + '>' + app.wallConditions[key].name + '</option>';
                }
                html += '</select></td>';
                
                html += '<td class="p-2 md:p-3">';
                html += '<select onchange="updateSection(' + section.id + ', \'paintType\', this.value); render();" class="w-full px-2 py-1 md:px-3 md:py-2 border rounded-lg text-xs md:text-sm">';
                for (var key in app.paintTypes) {
                    var selected = section.paintType === key ? 'selected' : '';
                    html += '<option value="' + key + '" ' + selected + '>' + app.paintTypes[key].name + '</option>';
                }
                html += '</select></td></tr>';
            }
            html += '</tbody></table></div>';

            html += '<div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 mt-4 md:mt-6">';
            html += '<div class="bg-indigo-50 p-3 md:p-4 rounded-lg">';
            html += '<label class="block text-xs md:text-sm font-medium text-gray-700 mb-2">Number of Workers - تعداد نقاش</label>';
            html += '<input type="number" min="1" value="' + app.workers + '" onchange="app.workers = parseInt(this.value) || 1" class="w-full px-3 py-2 border rounded-lg">';
            html += '</div>';
            html += '<div class="bg-yellow-50 p-3 md:p-4 rounded-lg">';
            html += '<label class="block text-xs md:text-sm font-medium text-gray-700 mb-2">Cleaning & Control (h) - نظافت (ساعت)</label>';
            html += '<input type="number" min="0" step="0.5" value="' + app.finalCleaningHours + '" onchange="app.finalCleaningHours = parseFloat(this.value) || 0" class="w-full px-3 py-2 border rounded-lg">';
            html += '</div></div>';

            html += '<button onclick="calculateTime()" class="w-full mt-4 md:mt-6 bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-lg font-bold text-sm md:text-base">محاسبه - Calculate</button>';
            html += '</div>';

            // Results
            if (app.result) {
                html += '<div class="bg-white rounded-2xl shadow-xl p-4 md:p-6">';
                html += '<h2 class="text-lg md:text-xl font-bold text-gray-800 mb-4">Results - نتیجه</h2>';
                
                html += '<div class="mb-6 overflow-x-auto"><table class="w-full min-w-full">';
                html += '<thead><tr class="bg-gray-100">';
                html += '<th class="p-2 text-right text-xs md:text-sm">Section</th>';
                html += '<th class="p-2 text-center text-xs md:text-sm">Area</th>';
                html += '<th class="p-2 text-center text-xs md:text-sm">Paint</th>';
                html += '<th class="p-2 text-center text-xs md:text-sm">Condition</th>';
                html += '<th class="p-2 text-center text-xs md:text-sm">Time</th>';
                html += '</tr></thead><tbody>';
                
                for (var i = 0; i < app.result.sections.length; i++) {
                    var s = app.result.sections[i];
                    var bgClass = i % 2 === 0 ? 'bg-gray-50' : '';
                    html += '<tr class="' + bgClass + '">';
                    html += '<td class="p-2 text-xs md:text-sm">' + s.name + '</td>';
                    html += '<td class="p-2 text-center text-xs md:text-sm">' + s.area + '</td>';
                    html += '<td class="p-2 text-center text-xs">' + s.paintType + '</td>';
                    html += '<td class="p-2 text-center text-xs">' + s.condition + '</td>';
                    html += '<td class="p-2 text-center font-bold text-xs md:text-sm">' + s.time + '</td>';
                    html += '</tr>';
                }
                html += '</tbody></table></div>';

                html += '<div class="bg-gradient-to-r from-green-50 to-emerald-50 p-4 md:p-6 rounded-lg border-r-4 border-green-500 mb-4 md:mb-6">';
                html += '<h3 class="font-bold text-base md:text-lg text-gray-800 mb-3 md:mb-4">Time Summary - خلاصه زمان</h3>';
                html += '<div class="grid grid-cols-2 gap-3 md:gap-4">';
                html += '<div class="bg-white p-3 md:p-4 rounded-lg"><p class="text-xs text-gray-600">Total Work</p><p class="text-lg md:text-2xl font-bold text-blue-600">' + app.result.totalWorkTime + ' h</p></div>';
                html += '<div class="bg-white p-3 md:p-4 rounded-lg"><p class="text-xs text-gray-600">Per Worker</p><p class="text-lg md:text-2xl font-bold text-indigo-600">' + app.result.timePerWorker + ' h</p></div>';
                html += '<div class="bg-white p-3 md:p-4 rounded-lg"><p class="text-xs text-gray-600">Cleaning</p><p class="text-lg md:text-2xl font-bold text-yellow-600">' + app.result.cleaningTime + ' h</p></div>';
                html += '<div class="bg-gradient-to-r from-green-600 to-emerald-600 p-3 md:p-4 rounded-lg text-white"><p class="text-xs">Final Total</p><p class="text-xl md:text-3xl font-bold">' + app.result.finalTotalTime + ' h</p><p class="text-xs mt-1">(' + app.result.days + ' days)</p></div>';
                html += '</div></div>';

                html += '<button onclick="generatePDF()" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-3 rounded-lg font-bold text-sm md:text-base">Download PDF - دانلود گزارش</button>';
                html += '</div>';
            }

            document.getElementById('app').innerHTML = html;
        }

        // Initial render
        render();
    </script>
</body>
</html>